<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语跟读练习</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .word-highlight {
            transition: all 0.2s ease;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .word-highlight:hover {
            color: #3b82f6;
            background-color: #dbeafe;
        }
        .active-word {
            background-color: #3b82f6;
            color: white;
        }
        .audio-progress {
            -webkit-appearance: none;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            width: 100%;
        }
        .audio-progress::-webkit-progress-bar {
            background-color: #e2e8f0;
            border-radius: 3px;
        }
        .audio-progress::-webkit-progress-value {
            background-color: #3b82f6;
            border-radius: 3px;
        }
        .sentence-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .sentence-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #3b82f6;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .play-btn:hover {
            background-color: #2563eb;
            transform: scale(1.05);
        }
        .play-btn.playing {
            background-color: #ef4444;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="container mx-auto py-8 px-4 md:px-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 mb-2">英语跟读练习</h1>
            <p class="text-slate-600 mb-6">点击播放按钮跟读句子，点击单词听取发音</p>
        
            <!-- 背诵按钮和语速设置 -->
            <div class="mb-4 flex flex-wrap items-center justify-center gap-4">
                <button id="recite-btn" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">背诵</button>
                
                <!-- 语速设置 -->
                <div class="flex items-center space-x-2">
                    <label for="playback-rate" class="text-slate-700 font-medium">语速:</label>
                    <select id="playback-rate" class="px-2 py-1 border border-slate-300 rounded-md">
                        <option value="2">2.0x</option>
                        <option value="1.5">1.5x</option>
                        <option value="1" selected>1.0x</option>
                        <option value="0.75">0.75x</option>
                        <option value="0.5">0.5x</option>
                    </select>
                </div>
            </div>
        
            <!-- 学习模式选择 -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-slate-700 mb-3">选择学习模式:</h2>
                <div class="flex flex-wrap justify-center gap-4 mb-6">
                    <button id="mode-vocabulary" class="mode-btn px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 font-medium">背单词</button>
                    <button id="mode-textbook" class="mode-btn px-6 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 font-medium">学课文</button>
                </div>
                
                <!-- 背单词子选项 -->
                <div id="vocabulary-options" class="file-options flex flex-wrap justify-center gap-2 mb-6">
                    <h3 class="text-md font-semibold text-slate-700 w-full text-center mb-2">选择单词范围:</h3>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/01-10.json">1-10</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/11-20.json">11-20</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/21-30.json">21-30</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/31-40.json">31-40</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/41-50.json">41-50</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/51-60.json">51-60</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/61-70.json">61-70</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/71-80.json">71-80</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/81-90.json">81-90</button>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/91-100.json">91-100</button>
                </div>
                
                <!-- 学课文子选项 -->
                <div id="textbook-options" class="file-options flex flex-wrap justify-center gap-2 mb-6 hidden">
                    <h3 class="text-md font-semibold text-slate-700 w-full text-center mb-2">选择课文:</h3>
                    <button class="file-btn px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600" data-file="assets/grade4/unit2.json">Grade4 Unit2</button>
                </div>
            </div>
        </header>

        <main>
            <!-- 分页控件 -->
            <div class="flex justify-between items-center mb-6">
                <button id="prev-page" class="px-4 py-2 bg-slate-200 rounded-lg disabled:opacity-50" disabled>上一页</button>
                <div id="page-info" class="text-slate-600">第 <span id="current-page">1</span> 页，共 <span id="total-pages">1</span> 页</div>
                <button id="next-page" class="px-4 py-2 bg-slate-200 rounded-lg disabled:opacity-50" disabled>下一页</button>
            </div>
                
            <div id="sentences-container" class="space-y-6">
                <!-- 句子卡片将通过JavaScript动态生成 -->
            </div>
                
            <!-- 分页控件 -->
            <div class="flex justify-between items-center mt-6">
                <button id="prev-page-bottom" class="px-4 py-2 bg-slate-200 rounded-lg disabled:opacity-50" disabled>上一页</button>
                <div id="page-info-bottom" class="text-slate-600">第 <span id="current-page-bottom">1</span> 页，共 <span id="total-pages-bottom">1</span> 页</div>
                <button id="next-page-bottom" class="px-4 py-2 bg-slate-200 rounded-lg disabled:opacity-50" disabled>下一页</button>
            </div>
        </main>

        <footer class="mt-16 text-center text-sm text-slate-500">
            <p>英语学习助手 - 提升您的英语听说能力</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 全局变量
            let currentPage = 1;
            const itemsPerPage = 5; // 每页显示的句子数量
            let allSentences = [];
            let currentAudioFile = '';
            let isReciting = false; // 背诵模式状态
            let playbackRate = 1.0; // 默认播放速度

            // 解析时间戳为秒数
            function parseTimeToSeconds(timeStr) {
                const parts = timeStr.split(':');
                const hours = parseInt(parts[0], 10);
                const minutes = parseInt(parts[1], 10);
                const seconds = parseInt(parts[2], 10);
                return hours * 3600 + minutes * 60 + seconds;
            }

            // 加载JSON文件
            async function loadSentencesFromFile(filename) {
                try {
                    const response = await fetch(filename);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const sentences = await response.json();
                    
                    // 设置音频文件名
                    if (sentences.length > 0) {
                        // 处理不同字段名的情况
                        currentAudioFile = sentences[0].audioFile || sentences[0].mp3 || filename.replace('.json', '.mp3');
                    }
                    
                    return sentences;
                } catch (error) {
                    console.error('加载文件时出错:', error);
                    alert('加载文件时出错: ' + error.message);
                    return [];
                }
            }

            // 初始化页面
            async function init() {
                // 加载默认文件
                allSentences = await loadSentencesFromFile('assets/01-10.json');
                updatePagination();
                displaySentences();
                
                // 绑定事件监听器
                document.getElementById('prev-page').addEventListener('click', () => changePage(currentPage - 1));
                document.getElementById('next-page').addEventListener('click', () => changePage(currentPage + 1));
                document.getElementById('prev-page-bottom').addEventListener('click', () => changePage(currentPage - 1));
                document.getElementById('next-page-bottom').addEventListener('click', () => changePage(currentPage + 1));
                
                // 为文件按钮绑定事件监听器
                document.querySelectorAll('.file-btn').forEach(button => {
                    button.addEventListener('click', loadFileFromButton);
                });
                
                // 为背诵按钮绑定事件监听器
                document.getElementById('recite-btn').addEventListener('click', toggleReciteMode);
                
                // 为语速选择框绑定事件监听器
                document.getElementById('playback-rate').addEventListener('change', function() {
                    playbackRate = parseFloat(this.value);
                    // 如果有音频正在播放，更新其播放速度
                    if (globalAudio) {
                        globalAudio.playbackRate = playbackRate;
                    }
                });
                
                // 为学习模式按钮绑定事件监听器
                document.getElementById('mode-vocabulary').addEventListener('click', () => switchMode('vocabulary'));
                document.getElementById('mode-textbook').addEventListener('click', () => switchMode('textbook'));
                
                // 默认显示背单词模式
                switchMode('vocabulary');
            }

            // 切换学习模式
            function switchMode(mode) {
                const vocabBtn = document.getElementById('mode-vocabulary');
                const textbookBtn = document.getElementById('mode-textbook');
                const vocabOptions = document.getElementById('vocabulary-options');
                const textbookOptions = document.getElementById('textbook-options');
                
                if (mode === 'vocabulary') {
                    // 更新按钮样式
                    vocabBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                    vocabBtn.classList.add('bg-green-700');
                    textbookBtn.classList.remove('bg-indigo-700');
                    textbookBtn.classList.add('bg-indigo-500', 'hover:bg-indigo-600');
                    
                    // 显示/隐藏选项
                    vocabOptions.classList.remove('hidden');
                    textbookOptions.classList.add('hidden');
                } else if (mode === 'textbook') {
                    // 更新按钮样式
                    textbookBtn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
                    textbookBtn.classList.add('bg-indigo-700');
                    vocabBtn.classList.remove('bg-green-700');
                    vocabBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                    
                    // 显示/隐藏选项
                    textbookOptions.classList.remove('hidden');
                    vocabOptions.classList.add('hidden');
                }
            }

            // 切换背诵模式
            function toggleReciteMode() {
                isReciting = !isReciting;
                const reciteBtn = document.getElementById('recite-btn');
                
                if (isReciting) {
                    reciteBtn.textContent = '取消背诵';
                    reciteBtn.classList.remove('bg-purple-500', 'hover:bg-purple-600');
                    reciteBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                    // 隐藏所有英文内容
                    hideEnglishContent();
                } else {
                    reciteBtn.textContent = '背诵';
                    reciteBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                    reciteBtn.classList.add('bg-purple-500', 'hover:bg-purple-600');
                    // 显示所有英文内容
                    showEnglishContent();
                }
            }

            // 隐藏英文内容
            function hideEnglishContent() {
                const englishElements = document.querySelectorAll('.sentence-card .text-lg, .sentence-card .text-xl');
                englishElements.forEach(element => {
                    element.style.color = '#f8fafc'; // 设置为背景色
                });
            }

            // 显示英文内容
            function showEnglishContent() {
                const englishElements = document.querySelectorAll('.sentence-card .text-lg, .sentence-card .text-xl');
                englishElements.forEach(element => {
                    element.style.color = ''; // 恢复默认颜色
                });
            }

            // 全局音频对象
            let globalAudio = null;
            let currentPlayingCard = null;

            // 创建句子卡片
            function createSentenceCard(sentence) {
                const card = document.createElement('div');
                card.className = 'sentence-card bg-white rounded-lg p-6';
                card.dataset.sentenceId = sentence.id;

                // 英文句子容器
                const englishContainer = document.createElement('div');
                englishContainer.className = 'text-lg md:text-xl font-medium text-slate-800 mb-3';
                englishContainer.id = `sentence-${sentence.id}`;

                // 处理英文文本中的换行符
                const englishText = sentence.english;
                const englishLines = englishText.split('\n');
                englishLines.forEach((line, index) => {
                    if (line.trim() !== '') {
                        // 分割句子为单词并创建可点击的单词元素
                        const words = line.split(/(\s+)/);
                        words.forEach((word, wordIndex) => {
                            if (word.trim() === '') {
                                englishContainer.appendChild(document.createTextNode(word));
                                return;
                            }

                            const wordSpan = document.createElement('span');
                            wordSpan.className = 'word-highlight';
                            wordSpan.textContent = word;
                            
                            // 为单词添加点击事件，播放单词发音
                            wordSpan.addEventListener('click', (e) => {
                                e.stopPropagation();
                                const cleanWord = word.replace(/[.,?!;:"]/g, '').toLowerCase();
                                playWordAudio(cleanWord);
                            });

                            englishContainer.appendChild(wordSpan);
                        });
                    }
                    
                    // 如果不是最后一行，添加换行元素
                    if (index < englishLines.length - 1) {
                        englishContainer.appendChild(document.createElement('br'));
                    }
                });

                // 中文翻译
                const chineseDiv = document.createElement('div');
                chineseDiv.className = 'text-slate-600 mb-4';
                
                // 处理中文文本中的换行符
                const chineseText = sentence.chinese;
                const chineseLines = chineseText.split('\n');
                chineseLines.forEach((line, index) => {
                    chineseDiv.appendChild(document.createTextNode(line));
                    // 如果不是最后一行，添加换行元素
                    if (index < chineseLines.length - 1) {
                        chineseDiv.appendChild(document.createElement('br'));
                    }
                });

                // 音频控制区域
                const audioControl = document.createElement('div');
                audioControl.className = 'flex items-center space-x-4';

                // 播放按钮
                const playButton = document.createElement('div');
                playButton.className = 'play-btn';
                playButton.innerHTML = '<i class="fas fa-play"></i>';

                // 如果没有时间戳信息，则不显示进度条
                if (sentence.startTime !== undefined && sentence.endTime !== undefined) {
                    // 进度条容器
                    const progressContainer = document.createElement('div');
                    progressContainer.className = 'flex-1';

                    // 进度条
                    const progressBar = document.createElement('progress');
                    progressBar.className = 'audio-progress';
                    progressBar.value = 0;
                    progressBar.max = 100;

                    progressContainer.appendChild(progressBar);

                    // 播放时间显示
                    const timeDisplay = document.createElement('div');
                    timeDisplay.className = 'text-sm text-slate-500 w-20 text-right';
                    timeDisplay.textContent = '00:00';

                    // 将元素添加到音频控制区域
                    audioControl.appendChild(playButton);
                    audioControl.appendChild(progressContainer);
                    audioControl.appendChild(timeDisplay);

                    // 为播放按钮添加点击事件
                    playButton.addEventListener('click', () => {
                        playSentenceAudio(sentence, playButton, progressBar, timeDisplay, card);
                    });
                } else {
                    // 如果没有时间戳信息，只显示播放按钮
                    audioControl.appendChild(playButton);
                    
                    // 为播放按钮添加点击事件
                    playButton.addEventListener('click', () => {
                        playSentenceAudioSimple(sentence, playButton, card);
                    });
                }

                // 组装卡片
                card.appendChild(englishContainer);
                card.appendChild(chineseDiv);
                card.appendChild(audioControl);

                return card;
            }

            // 播放单词音频（使用有道词典API）
            function playWordAudio(word) {
                if (!word) return;
                
                const audioUrl = `http://dict.youdao.com/dictvoice?type=1&audio=${encodeURIComponent(word)}`;
                const audio = new Audio(audioUrl);
                audio.play();
            }

            // 简单播放句子音频（无时间戳信息）
            function playSentenceAudioSimple(sentence, playButton, card) {
                // 如果有其他句子正在播放，停止它们
                if (globalAudio && currentPlayingCard && currentPlayingCard !== card) {
                    globalAudio.pause();
                    const oldPlayButton = currentPlayingCard.querySelector('.play-btn');
                    if (oldPlayButton) {
                        oldPlayButton.innerHTML = '<i class="fas fa-play"></i>';
                        oldPlayButton.classList.remove('playing');
                    }
                }

                // 如果当前句子正在播放，切换播放/暂停状态
                if (globalAudio && currentPlayingCard === card) {
                    if (!globalAudio.paused) {
                        globalAudio.pause();
                        playButton.innerHTML = '<i class="fas fa-play"></i>';
                        playButton.classList.remove('playing');
                        return;
                    } else {
                        globalAudio.play();
                        playButton.innerHTML = '<i class="fas fa-pause"></i>';
                        playButton.classList.add('playing');
                        return;
                    }
                }

                // 创建新的音频对象，处理不同字段名的情况
                const audioFile = sentence.mp3 || sentence.audioFile;
                globalAudio = new Audio(audioFile);
                currentPlayingCard = card;

                // 设置播放速度
                globalAudio.playbackRate = playbackRate;

                // 播放音频
                globalAudio.play();
                playButton.innerHTML = '<i class="fas fa-pause"></i>';
                playButton.classList.add('playing');

                // 音频播放结束时的处理
                globalAudio.addEventListener('ended', () => {
                    playButton.innerHTML = '<i class="fas fa-play"></i>';
                    playButton.classList.remove('playing');
                });

                // 音频播放错误处理
                globalAudio.addEventListener('error', () => {
                    playButton.innerHTML = '<i class="fas fa-play"></i>';
                    playButton.classList.remove('playing');
                    alert('音频播放出错，请检查文件路径是否正确');
                });
            }

            // 播放句子音频
            function playSentenceAudio(sentence, playButton, progressBar, timeDisplay, card) {
                // 如果有其他句子正在播放，停止它们
                if (globalAudio && currentPlayingCard && currentPlayingCard !== card) {
                    globalAudio.pause();
                    const oldPlayButton = currentPlayingCard.querySelector('.play-btn');
                    if (oldPlayButton) {
                        oldPlayButton.innerHTML = '<i class="fas fa-play"></i>';
                        oldPlayButton.classList.remove('playing');
                    }
                }

                // 如果当前句子正在播放，切换播放/暂停状态
                if (globalAudio && currentPlayingCard === card) {
                    if (!globalAudio.paused) {
                        globalAudio.pause();
                        playButton.innerHTML = '<i class="fas fa-play"></i>';
                        playButton.classList.remove('playing');
                        return;
                    } else {
                        globalAudio.play();
                        playButton.innerHTML = '<i class="fas fa-pause"></i>';
                        playButton.classList.add('playing');
                        return;
                    }
                }

                // 创建新的音频对象，处理不同字段名的情况
                const audioFile = sentence.mp3 || sentence.audioFile;
                globalAudio = new Audio(audioFile);
                currentPlayingCard = card;

                // 设置播放速度
                globalAudio.playbackRate = playbackRate;

                // 设置音频的播放区间
                globalAudio.currentTime = sentence.startTime || 0;
                
                // 播放音频
                globalAudio.play();
                playButton.innerHTML = '<i class="fas fa-pause"></i>';
                playButton.classList.add('playing');

                // 获取句子元素中的单词
                const sentenceElement = document.getElementById(`sentence-${sentence.id}`);
                const wordElements = sentenceElement.querySelectorAll('.word-highlight');
                
                // 重置所有高亮
                wordElements.forEach(el => {
                    el.classList.remove('active-word');
                });

                // 更新进度条和时间显示
                const updateProgress = setInterval(() => {
                    if (!globalAudio) return;
                    
                    // 检查是否超出播放时间范围
                    const endTime = sentence.endTime || globalAudio.duration;
                    if (globalAudio.currentTime >= endTime) {
                        globalAudio.pause();
                        clearInterval(updateProgress);
                        playButton.innerHTML = '<i class="fas fa-play"></i>';
                        playButton.classList.remove('playing');
                        progressBar.value = 100;
                        timeDisplay.textContent = formatTime(endTime) + ' / ' + formatTime(endTime);
                        
                        // 移除所有高亮
                        wordElements.forEach(el => {
                            el.classList.remove('active-word');
                        });
                        return;
                    }
                    
                    // 更新进度条
                    const startTime = sentence.startTime || 0;
                    const progress = ((globalAudio.currentTime - startTime) / (endTime - startTime)) * 100;
                    progressBar.value = progress;
                    
                    // 更新时间显示
                    const currentTime = globalAudio.currentTime - startTime;
                    const totalDuration = endTime - startTime;
                    timeDisplay.textContent = formatTime(currentTime) + ' / ' + formatTime(totalDuration);
                }, 100);

                // 音频播放结束时的处理
                globalAudio.addEventListener('ended', () => {
                    clearInterval(updateProgress);
                    playButton.innerHTML = '<i class="fas fa-play"></i>';
                    playButton.classList.remove('playing');
                    progressBar.value = 0;
                    timeDisplay.textContent = '00:00';
                    
                    // 移除所有高亮
                    wordElements.forEach(el => {
                        el.classList.remove('active-word');
                    });
                });

                // 音频播放错误处理
                globalAudio.addEventListener('error', () => {
                    clearInterval(updateProgress);
                    playButton.innerHTML = '<i class="fas fa-play"></i>';
                    playButton.classList.remove('playing');
                    progressBar.value = 0;
                    timeDisplay.textContent = '00:00';
                    alert('音频播放出错，请检查文件路径是否正确');
                });
            }

            // 通过按钮加载文件
            async function loadFileFromButton(event) {
                const filename = event.target.dataset.file;
                
                // 更新按钮样式以显示当前选中
                document.querySelectorAll('.file-btn').forEach(btn => {
                    btn.classList.remove('bg-blue-700');
                    btn.classList.add('bg-blue-500');
                });
                event.target.classList.remove('bg-blue-500');
                event.target.classList.add('bg-blue-700');
                
                allSentences = await loadSentencesFromFile(filename);
                currentPage = 1;
                updatePagination();
                displaySentences();
            }

            // 更新分页信息
            function updatePagination() {
                const totalPages = Math.ceil(allSentences.length / itemsPerPage);
                
                // 更新顶部分页控件
                document.getElementById('current-page').textContent = currentPage;
                document.getElementById('total-pages').textContent = totalPages;
                document.getElementById('prev-page').disabled = currentPage === 1;
                document.getElementById('next-page').disabled = currentPage === totalPages;
                
                // 更新底部分页控件
                document.getElementById('current-page-bottom').textContent = currentPage;
                document.getElementById('total-pages-bottom').textContent = totalPages;
                document.getElementById('prev-page-bottom').disabled = currentPage === 1;
                document.getElementById('next-page-bottom').disabled = currentPage === totalPages;
            }

            // 切换页面
            function changePage(page) {
                const totalPages = Math.ceil(allSentences.length / itemsPerPage);
                
                if (page >= 1 && page <= totalPages) {
                    currentPage = page;
                    updatePagination();
                    displaySentences();
                    
                    // 滚动到页面顶部
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }

            // 显示当前页的句子
            function displaySentences() {
                const container = document.getElementById('sentences-container');
                container.innerHTML = '';
                
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, allSentences.length);
                
                // 为当前页的每个句子创建卡片
                for (let i = startIndex; i < endIndex; i++) {
                    // 更新音频文件名，处理不同字段名的情况
                    allSentences[i].audioFile = allSentences[i].mp3 || currentAudioFile;
                    const card = createSentenceCard(allSentences[i]);
                    container.appendChild(card);
                }
                
                // 如果处于背诵模式，继续保持隐藏英文内容
                if (isReciting) {
                    hideEnglishContent();
                }
            }

            // 通过按钮加载文件
            async function loadFileFromButton(event) {
                const filename = event.target.dataset.file;
                
                // 更新按钮样式以显示当前选中
                document.querySelectorAll('.file-btn').forEach(btn => {
                    btn.classList.remove('bg-blue-700');
                    btn.classList.add('bg-blue-500');
                });
                event.target.classList.remove('bg-blue-500');
                event.target.classList.add('bg-blue-700');
                
                allSentences = await loadSentencesFromFile(filename);
                currentPage = 1;
                updatePagination();
                displaySentences();
            }

            // 格式化时间显示
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            // 启动应用
            init();
        });
    </script>
</body>
</html>